{% extends 'base.html' %} {% block head %}
<title>Select media</title>
{% endblock %} {% block body %}

<!-- TODO FIX THIS FUNCTION, currently mp4 is not defined in add_media -->
<div class="content">
  {% for i in range(card.getMedia()["mp4s"]|length) %} 
  {% set mp4 = card.getMedia()["mp4s"][i] %}
  <br>
  <script>
    var addButton = document.createElement("input");
    addButton.id = "{{mp4}}";
    addButton.type = "button";
    addButton.style.backgroundColor = "orange";
    addButton.value = "Add to Card";

    document.getElementsByClassName("content")[0].appendChild(addButton);
  </script>

  <div>
    <video width="400" controls>
      <source src="{{mp4}}" type="video/mp4" />
    </video>
  </div>
  <br>
  {% endfor %}

  {% set mp4s = card.getMedia()["mp4s"] %}
  <script>
    var mp4_list = JSON.parse('{{ mp4s | tojson | safe }}');
    function add_on_click() {
      for (let i = 0; i < mp4_list.length; i++) {
        mp4 = mp4_list[i]
        var btn = getElementById(mp4);
        btn.addEventListener(
          'click', 
          function() {
            add_media(mp4);
          }
        );
      }
    }
    add_on_click();
  </script>

</div>

<script>
  function add_media(mp4) {
    console.log(mp4);
    el = document.getElementById(mp4);
    console.log(el);
    if (el.style.backgroundColor == "orange") {
      el.style.backgroundColor = "lightgreen";
      card.media += [mp4];
      console.log(card.media);
    } else {
      el.style.backgroundColor = "orange";
      card.media.remove(mp4);
      console.log(card.media);
    }
  }
</script>

{% endblock %}
