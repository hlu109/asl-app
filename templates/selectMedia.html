{% extends 'base.html' %} {% block head %}

<title>Select media</title>
{% endblock %} {% block body %}

<div class="content">
  {% for i in range(mp4s[0]|length) %} 
  {% set mp4 = mp4s[0][i] %}
  <br>
  <script>
    console.log('mp4 link')
    console.log('{{mp4}}')
    var addButton = document.createElement("input");
    addButton.id = "{{i}}";
    addButton.type = "button";
    addButton.style.backgroundColor = "orange";
    addButton.value = "Add to Card";

    document.getElementsByClassName("content")[0].appendChild(addButton);
  </script>
  
  <br>
  <video width="400" controls>
    <source src="{{mp4}}" type="video/mp4" />
  </video>
  <br>

  {% endfor %}

  <button type="button" onclick="finish()">Finish Card</button>

  {% set num_media = mp4s|length %}
  <script>
    let mp4_keep = new Array(parseInt("{{num_media}}"));
    mp4_keep.fill(0);
    function add_on_click() {
      for (let i = 0; i < parseInt("{{num_media}}"); i++) {
        (
          function() {
            var btn = document.getElementById(i);
            btn.addEventListener(
              'click', 
              function() {
                add_media(i);
              }
            );
          } 
          () 
        );
      }
    }
    add_on_click();
  </script>

</div>

<script>
  function add_media(i) {
    el = document.getElementById(i);
    if (el.style.backgroundColor == "orange") {
      el.style.backgroundColor = "lightgreen";
      el.value = "Remove from Card";
      mp4_keep[i] = 1;
      console.log("list", mp4_keep);
    } else {
      el.style.backgroundColor = "orange";
      el.value = "Add to Card";
      mp4_keep[i] = 0;
      console.log("list", mp4_keep);
    }
  }

  function finish() {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = "/{{deck_name}}/{{term}}";

    const field1 = document.createElement('input');
    field1.type = 'hidden';
    field1.name = 'mp4_keep';
    field1.value = mp4_keep.toString();
    
    const field2 = document.createElement('input');
    field2.type = 'hidden';
    field2.name = 'url_suffix';
    field2.value = "{{url_suffix}}";

    const field3 = document.createElement('input');
    field3.type = 'hidden';
    field3.name = 'new_card';
    field3.value = "True";

    form.appendChild(field1);
    form.appendChild(field2);
    form.appendChild(field3);
    document.body.appendChild(form);
    form.submit();
  }
</script>

{% endblock %}
